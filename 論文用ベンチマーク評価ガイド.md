# 📚 論文用ベンチマーク評価ガイド

## 概要

既存研究との**公平な比較**のため、標準的なBicubic縮小で基準画像を作成し、AI超解像モデルを定量評価します。論文投稿に必要な統計データを生成します。

---

## 🔄 処理フロー（全5ステップ）

### **Step 0: バッチBicubic縮小（準備段階・オプション）**

高解像度GT画像から低解像度LR画像を生成（×2 SR評価用）

```
入力: 高解像度GT画像フォルダ（例: 1000×1000px × 15,000枚）
  ↓ Bicubic縮小（×0.5）
出力: 低解像度LR画像フォルダ（例: 500×500px × 15,000枚）
```

**設定項目:**
- 入力フォルダ: 高解像度GT画像
- 出力フォルダ: 低解像度LR画像の保存先
- 縮小倍率: 0.5（デフォルト、×2超解像評価用）

**既にLR画像がある場合はスキップ可能**

---

### **Step 1: 高解像度画像を用意**

**推奨枚数:** 15,000枚（論文の信頼性のため）
- 最低: 300枚（統計的に有意）
- 推奨: 15,000枚（標準ベンチマーク）

**画像形式:** PNG推奨（JPGは非可逆圧縮で不適切）

**フォルダ構成例:**
```
dataset/
  ├─ original/           # 高解像度GT画像（1000×1000px × 15,000枚）
  ├─ model_a/            # モデルAの超解像結果（1000×1000px × 15,000枚）
  ├─ model_b/            # モデルBの超解像結果（1000×1000px × 15,000枚）
  └─ model_c/            # モデルCの超解像結果（1000×1000px × 15,000枚）
```

---

### **Step 2: 元画像・超解像モデルフォルダを設定**

論文用ベンチマーク評価タブで以下を設定：

#### 1. **📁 元画像フォルダ（必須）**
   - `dataset/original/` を指定
   - PNG形式を使用（⚠️警告参照）

#### 2. **🤖 超解像モデルフォルダ（最低1つ、最大5個）**
   - モデル1名: `Model_A` → `dataset/model_a/`
   - モデル2名: `Model_B` → `dataset/model_b/`
   - モデル3名: `Model_C` → `dataset/model_c/`

#### 3. **💾 出力設定**
   - CSV: `batch_results_academic_20251027_073043.csv`（自動タイムスタンプ）
   - 詳細: `batch_results_detail_academic_20251027_073043/`

#### 4. **⚙️ その他設定**
   - 処理枚数制限: 0（全て処理）
   - 追加/上書き: 追加モード（推奨）

---

### **Step 3: バッチ処理開始（数時間～1日）**

**🚀 論文用ベンチマーク評価開始** ボタンをクリック

**処理内容:**
```
元画像1 vs モデルA → 26指標を計算
元画像1 vs モデルB → 26指標を計算
元画像1 vs モデルC → 26指標を計算
...
（15,000枚 × 3モデル = 45,000回の比較）
```

**評価モード:** 学術評価モード（academic）固定
- PSNR、SSIM、LPIPS等の標準指標
- ハルシネーション検出（26パターン）
- 論文でよく使われる指標セット

**所要時間:**
- 300枚 × 3モデル = 約1時間
- 15,000枚 × 3モデル = 約12～24時間（GPU性能に依存）

**出力:**
- CSV: 全比較結果（45,000行 × 26列）
- 詳細フォルダ: 各比較の詳細画像・グラフ

---

### **Step 4: 統計分析・25種類プロット生成 ⭐必須**

バッチ処理完了後、**必ず統計分析を実行**してください。

**📊 統計分析・プロット生成** セクション:

1. **CSVファイルを選択**
   - バッチ処理で生成されたCSVが自動入力される
   - 手動で選択も可能

2. **📈 統計分析実行** ボタンをクリック

**生成される25種類のプロット:**
```
analysis_output/
  ├─ model_comparison.csv              # モデル別平均スコア
  ├─ model_scores.png                  # モデル比較棒グラフ
  ├─ radar_chart_model_comparison.png  # レーダーチャート
  ├─ correlation_matrix.png            # 相関行列
  ├─ pca_2d_projection.png             # PCA 2D投影
  ├─ pca_cumulative_variance.png       # PCA累積寄与率
  ├─ violin_plots_all_metrics.png      # バイオリンプロット
  ├─ percentile_bands.png              # パーセンタイルバンド
  ├─ distribution_total_score_histogram.png  # スコア分布
  ├─ stability_lpips_boxplot.png       # 安定性分析
  ├─ tradeoff_psnr_vs_contrast.png     # トレードオフ分析（PSNR vs コントラスト）
  ├─ tradeoff_ssim_vs_noise.png        # トレードオフ分析（SSIM vs ノイズ）
  ├─ tradeoff_sharpness_vs_artifact.png  # トレードオフ分析（シャープネス vs アーティファクト）
  ├─ tradeoff_lpips_vs_msssim.png      # トレードオフ分析（LPIPS vs MS-SSIM）
  ├─ tradeoff_texture_vs_highfreq.png  # トレードオフ分析（テクスチャ vs 高周波）
  ├─ strategy_map_sharpness_vs_psnr.png  # 戦略マップ
  ├─ correlation_ssim_vs_psnr.png      # 相関分析（SSIM vs PSNR）
  ├─ quality_noise_vs_artifact.png     # 品質分析（ノイズ vs アーティファクト）
  ├─ hallucination_ssim_high_psnr_low.png  # ハルシネーション分析（SSIM高・PSNR低）
  ├─ hallucination_sharpness_vs_noise.png  # ハルシネーション分析（シャープネス vs ノイズ）
  ├─ hallucination_edge_vs_local_std.png   # ハルシネーション分析（エッジ vs ローカルSTD）
  ├─ hallucination_highfreq_vs_entropy.png # ハルシネーション分析（高周波 vs エントロピー）
  ├─ medical_contrast_vs_histogram.png     # 医療画像分析（コントラスト vs ヒストグラム）
  ├─ medical_deltae_vs_lab.png             # 医療画像分析（ΔE vs LAB）
  ├─ medical_edge_vs_local_quality.png     # 医療画像分析（エッジ vs ローカル品質）
  ├─ medical_noise_vs_local_std.png        # 医療画像分析（ノイズ vs ローカルSTD）
  └─ recommended_thresholds.json           # 推奨閾値（JSON）
```

**論文で使えるデータ:**
- モデル比較表（CSV）
- 統計的有意差検定
- パーセンタイルバンド
- 推奨閾値（自動計算）

---

### **Step 5: detection_count（26パターン）確認 → 深層学習へ**

**パターン検出の統計分析** セクション:

1. **CSVファイルを選択**（Step 3と同じCSV）

2. **🔍 パターン検出分析実行** ボタンをクリック

**生成される解析結果:**
```
analysis_output/
  ├─ results_with_26pattern_detection.csv   # 26パターン検出結果付きCSV
  └─ pattern_detection_summary.csv          # パターン別統計サマリー
```

**26パターンの検出項目:**
1. ハルシネーション（SSIM高・PSNR低）
2. 医療画像異常（ΔE高・LAB異常）
3. ノイズ・アーティファクト
4. エッジ劣化
5. 色異常
6. テクスチャ異常
7. シャープネス異常
8. コントラスト異常
9. 高周波成分異常
10. エントロピー異常
... （合計26種類）

**活用方法:**
- 検出されたパターンをAI学習の特徴量として使用
- ハルシネーション予測モデルの構築
- 品質保証の自動化

---

## 📊 論文投稿用データの使い方

### 1. モデル比較表（Table）

`model_comparison.csv` をそのまま論文に掲載可能

```
Model      | PSNR↑ | SSIM↑ | LPIPS↓ | MS-SSIM↑ | Total Score↑
-----------|-------|-------|--------|----------|-------------
Model_A    | 28.45 | 0.875 | 0.123  | 0.912    | 87.3
Model_B    | 27.89 | 0.862 | 0.145  | 0.895    | 84.1
Model_C    | 29.12 | 0.891 | 0.098  | 0.934    | 91.5
```

### 2. グラフ（Figure）

以下のプロットを論文に掲載:
- `model_scores.png` - モデル比較棒グラフ
- `radar_chart_model_comparison.png` - 多次元評価レーダーチャート
- `tradeoff_psnr_vs_contrast.png` - トレードオフ分析
- `hallucination_ssim_high_psnr_low.png` - ハルシネーション検出例

### 3. 統計的有意差検定

`recommended_thresholds.json` に含まれる統計情報:
```json
{
  "psnr": {
    "mean": 28.15,
    "median": 28.20,
    "std": 2.34,
    "percentile_25": 26.50,
    "percentile_50": 28.20,
    "percentile_75": 29.80,
    "recommended_threshold": 27.00
  },
  ...
}
```

### 4. ハルシネーション分析

`pattern_detection_summary.csv` で異常検出率を報告:
```
Model_A: 2.3% のハルシネーション検出（342/15000）
Model_B: 5.7% のハルシネーション検出（855/15000）
Model_C: 1.1% のハルシネーション検出（165/15000）
```

---

## ⚠️ 重要な注意事項

### PNG形式必須
- ❌ **JPGは非可逆圧縮で劣化済み**
  - ブロックノイズ（8×8ピクセル単位）
  - 高周波成分の損失
  - 色情報の劣化
  - AI超解像の劣化と区別不可能
- ✅ **PNG形式を使用**
  - 可逆圧縮
  - 劣化なし
  - 論文投稿に適切

### データセットサイズ
- **最低300枚**（統計的に有意）
- **推奨15,000枚**（標準ベンチマーク・DIV2K等）
- サンプル数が多いほど統計的信頼性が向上

### 評価モード
- **学術評価モード（academic）固定**
- Bicubic縮小 → AI超解像 → 元画像比較
- 既存研究との比較可能性を確保
- PSNR、SSIM等の標準指標を使用

### 処理時間
- **大規模データセットは長時間かかる**
  - 300枚 × 3モデル = 約1時間
  - 15,000枚 × 3モデル = 約12～24時間
- バックグラウンド実行を推奨
- 進捗は定期的に保存される（中断しても再開可能）

### ファイル名の対応
- **元画像とモデル出力のファイル名（拡張子なし）を一致させる**
  ```
  original/image001.png  ←→  model_a/image001.png
  original/image002.png  ←→  model_a/image002.png
  ```
- ファイル名が一致しない場合、その画像はスキップされる

---

## 🎯 処理フロー図

```
[高解像度GT画像 15,000枚]
         ↓
  [Step 0: Bicubic縮小]（オプション）
         ↓
  [低解像度LR画像]
         ↓
  [AI超解像モデルで処理]
         ↓
  [超解像結果 15,000枚]
         ↓
[Step 3: バッチ処理]
  元画像 vs 超解像結果
  （45,000回の比較）
         ↓
  [CSV出力: 45,000行 × 26列]
         ↓        ↓
  [Step 4]      [Step 5]
  統計分析      パターン検出
  25種類プロット  26パターン解析
         ↓        ↓
    [論文投稿用データ完成]
```

---

## 📖 論文投稿時のチェックリスト

- [ ] データセット枚数を明記（例: 15,000枚）
- [ ] 画像形式を明記（PNG、可逆圧縮）
- [ ] 評価モードを明記（学術評価モード・Bicubic baseline）
- [ ] 使用した指標を明記（PSNR、SSIM、LPIPS等）
- [ ] モデル比較表を掲載（`model_comparison.csv`）
- [ ] 統計的有意差を記載（平均値・標準偏差・パーセンタイル）
- [ ] ハルシネーション検出率を報告（`pattern_detection_summary.csv`）
- [ ] グラフを掲載（レーダーチャート、トレードオフ分析等）
- [ ] 推奨閾値を記載（`recommended_thresholds.json`）
- [ ] 再現性のための設定を記載（縮小倍率、評価モード等）

---

## 🔬 既存研究との比較

このツールで生成されるデータは、以下の標準ベンチマークと互換性があります：

- **DIV2K** (DIVerse 2K resolution dataset)
- **Set5/Set14** (Standard test sets)
- **BSD100** (Berkeley Segmentation Dataset)
- **Urban100** (Urban scenes)

評価指標も既存研究と同じため、直接比較が可能です。

---

## 💡 Tips

### 処理時間を短縮する
- GPUを使用（CUDA対応）
- 処理枚数制限機能を使って段階的に実行
- 小規模データセット（300枚）でテスト後、本番実行

### 論文の説得力を高める
- データセットを15,000枚以上に
- 複数のベンチマークデータセットで評価
- ハルシネーション検出率を明記
- 統計的有意差検定の結果を記載

### トラブルシューティング
- ファイル名が一致しない → ファイル名を統一
- JPG警告が出る → 元データからPNGで再出力
- 処理が遅い → GPU使用を確認、処理枚数を段階的に

---

## 📚 参考文献

このツールは以下の論文の評価手法を参考にしています：

- PSNR/SSIM: Wang et al., "Image Quality Assessment: From Error Visibility to Structural Similarity", IEEE TIP 2004
- LPIPS: Zhang et al., "The Unreasonable Effectiveness of Deep Features as a Perceptual Metric", CVPR 2018
- MS-SSIM: Wang et al., "Multi-Scale Structural Similarity for Image Quality Assessment", Asilomar 2003

---

**最終更新:** 2025-10-27
**バージョン:** v1.6+
